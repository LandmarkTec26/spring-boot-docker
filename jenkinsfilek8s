pipeline{
  agent any 
  tools{
    maven "maven3.8.4"
  }
stages{
stage('1.SCM Checkout'){
     steps{
 git 'https://github.com/LandmarkTec26/spring-boot-docker.git'
}
}  
stage('2.maven-Build'){ 
steps{
    sh "mvn clean package"
  }
}
stage('3.CodeQuality'){ 
steps{
    sh "mvn sonar:sonar"
  }
}
stage('4.UploadArtifacts'){ 
steps{
    sh "mvn deploy"
  }
}

stage('approval'){
steps{
timeout (time:5, unit:'HOURS'){
input message: "please verify and approve"
}
}
}
stage('Build Docker Image'){
steps{
sh "docker build -t kidunnu/spring-boot-mongo ."
    }
}
stage('Push Docker Image'){
steps{
      withCredentials([string(credentialsId: 'mydockercred', variable: 'mydockercred')]) {
      sh "docker login -u kidunnu -p ${mydockercred}" 
}
      sh "docker push kidunnu/spring-boot-mongo"
}
}
stage('Deploy To Kuberates Cluster'){
steps{
        sh "kubectl apply -f springapp.yml"
      } 
     }
}
}
